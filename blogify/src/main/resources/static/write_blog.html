<!DOCTYPE html>
<html>
<head>
    <title>Blogify - New Blog</title>
    <style>
        :root {
            --primary-green: #27ae60; --primary-dark: #1e8449; --secondary-light: #d5f5e3;
            --white: #ffffff; --gray-light: #f2f2f2; --text-dark: #2c3e50;
        }
        
        * { 
        	margin: 0; 
        	padding: 0; 
        	box-sizing: border-box; 
        	font-family: 'Segoe UI', sans-serif; 
        }
        
        body { 
        	background-color: var(--secondary-light); 
        	color: var(--text-dark); 
        }
        
        a { 
        	text-decoration: none; 
        	color: inherit; 
        }
        
        .navbar {
		    display: flex;
		    justify-content: space-between;
		    align-items: center;
		    background-color: var(--primary-green);
		    padding: 15px 50px;
		}
		
		.navbar .logo {
		    font-size: 24px;
		    font-weight: bold;
		    color: var(--white);
		}
		
		.navbar .nav-links a {
		    margin: 0 15px;
		    color: var(--white);
		    font-weight: 500;
		}
		
		.write-container {
		    display: flex;
		    justify-content: center;
		    padding: 40px 20px;
		}
		
		.write-box {
		    background-color: var(--white);
		    padding: 40px;
		    border-radius: 12px;
		    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
		    width: 100%;
		    max-width: 800px;
		}
		
		.write-box h2 {
		    text-align: center;
		    margin-bottom: 25px;
		    color: var(--primary-green);
		}
		
		.write-box label {
		    display: block;
		    margin-bottom: 5px;
		    font-weight: 500;
		}
		
		.write-box input,
		.write-box textarea {
		    width: 100%;
		    padding: 12px 15px;
		    margin-bottom: 20px;
		    border: 1px solid #ccc;
		    border-radius: 8px;
		    font-size: 14px;
		}
		
		.write-box input:focus,
		.write-box textarea:focus {
		    border-color: var(--primary-green);
		    outline: none;
		}
		
		.write-box textarea {
		    height: 250px;
		    resize: vertical;
		}
		
		.write-box button {
		    width: 100%;
		    padding: 14px;
		    background-color: var(--primary-green);
		    color: var(--white);
		    border: none;
		    border-radius: 8px;
		    font-size: 16px;
		    cursor: pointer;
		    font-weight: bold;
		}
		
		.write-box button:hover {
		    background-color: var(--primary-dark);
		}
		
		.profile-dropdown {
		    position: relative;
		    display: inline-block;
		}
		
		.profile-dropdown-content {
		    display: none;
		    position: absolute;
		    right: 0;
		    background-color: #f9f9f9;
		    min-width: 160px;
		    box-shadow: 0 8px 16px 0 rgba(0, 0, 0, 0.2);
		    z-index: 1;
		}
		
		.nav-links .profile-dropdown-content a {
		    color: var(--primary-green);
		    padding: 12px 16px;
		    display: block;
		}
		
		.profile-dropdown:hover .profile-dropdown-content {
		    display: block;
		}
    </style>
</head>
<body>

    <nav class="navbar">
        <div class="logo">Blogify</div>
        <div class="nav-links" id="navLinks"></div>
    </nav>

    <div class="write-container">
        <div class="write-box">
            <h2>Write a New Blog</h2>
            <form id="writeBlogForm">
                <label for="title">Title</label>
                <input type="text" id="title" placeholder="Enter the blog title" required>

                <label for="subtitle">Subtitle</label>
                <input type="text" id="subtitle" placeholder="Enter the blog subtitle" required>

                <label for="imageUrl">Image URL</label>
                <input type="text" id="imageUrl" placeholder="Enter image URL (optional)">

                <label for="content">Content</label>
                <textarea id="content" placeholder="Write your blog content here..." required></textarea>

                <button type="submit">Post Blog</button>
            </form>
        </div>
    </div>

    <script>
        const form = document.getElementById("writeBlogForm");
        const titleInput = document.getElementById("title");
        const subtitleInput = document.getElementById("subtitle");
        const imageUrlInput = document.getElementById("imageUrl");
        const contentInput = document.getElementById("content");
        const formButton = form.querySelector("button");
        const formTitle = document.querySelector(".write-box h2");
        
        const params = new URLSearchParams(window.location.search);
        const editId = params.get("editId");
        const isEditMode = editId !== null;

        if (isEditMode) {
            formTitle.innerText = "Edit Your Blog";
            formButton.innerText = "Update Blog";

            fetch(`/api/blogs/${editId}`)
                .then(res => res.json())
                .then(blog => {
                    titleInput.value = blog.title;
                    subtitleInput.value = blog.subtitle;
                    imageUrlInput.value = blog.imageUrl;
                    contentInput.value = blog.content;
                });
        }

        form.addEventListener("submit", function(e) {
            e.preventDefault();
            const currentUser = JSON.parse(localStorage.getItem("currentUser"));
            if (!currentUser) {
                alert("Please log in to post or edit a blog.");
                return;
            }

            const blogData = {
                title: titleInput.value,
                subtitle: subtitleInput.value,
                imageUrl: imageUrlInput.value,
                content: contentInput.value,
                userId: currentUser.userId
            };
            
            const method = isEditMode ? 'PUT' : 'POST';
            const url = isEditMode ? `/api/blogs/${editId}` : '/api/blogs';

            fetch(url, {
                method: method,
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(blogData)
            })
            .then(response => {
                if (response.ok) {
                    alert(isEditMode ? 'Blog updated successfully!' : 'Blog posted successfully!');
                    window.location.href = 'my_blogs.html';
                } else {
                    alert('An error occurred while saving the blog.');
                }
            })
            .catch(error => console.error("Error:", error));
        });
    </script> 
    <script>
	    document.addEventListener("DOMContentLoaded", function() {
	        const navLinks = document.getElementById("navLinks");
	        const currentUserJSON = localStorage.getItem("currentUser");
	        let navHTML = `
	            <a href="index.html">Home</a>
	            <a href="blogs.html">Blogs</a>
	            <a href="about.html">About</a>`;
	
	        if (currentUserJSON) {
	            const user = JSON.parse(currentUserJSON);
	            navHTML += `
	                <div class="profile-dropdown">
	                    <a href="#" class="profile-btn">Profile &#9662;</a>
	                    <div class="profile-dropdown-content">
	                        <a href="my_blogs.html">My Blogs</a>
	                        <a href="write_blog.html">Write</a>
	                        <a href="#" id="logoutBtn">Logout</a>
	                    </div>
	                </div>
	            `;
	        } else {
	            navHTML += `
	                <a href="login.html">Login</a>
	                <a href="signup.html">Sign Up</a>
	            `;
	        }
	
	        navLinks.innerHTML = navHTML;
	        const logoutBtn = document.getElementById("logoutBtn");
	        if (logoutBtn) {
	            logoutBtn.addEventListener("click", function(e) {
	                e.preventDefault();
	                localStorage.removeItem("currentUser");
	                window.location.href = "login.html";
	            });
	        }
	    });
	</script>
</body>
</html>